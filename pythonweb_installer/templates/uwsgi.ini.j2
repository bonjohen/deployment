[uwsgi]
; uWSGI configuration file
; Generated by PythonWeb Installer

; Basic configuration
socket = {{ socket|default('0.0.0.0:8000') }}
protocol = {{ protocol|default('http') }}
module = {{ app_module|default('app:app') }}
pythonpath = {{ python_path|default('.') }}
chdir = {{ app_dir|default('.') }}

; Process configuration
master = {{ 'true' if master|default(True) else 'false' }}
processes = {{ processes|default(4) }}
threads = {{ threads|default(2) }}
{% if async|default(False) %}
async = {{ async }}
{% endif %}
{% if ugreen|default(False) %}
ugreen = true
{% endif %}
harakiri = {{ harakiri|default(30) }}
harakiri-verbose = {{ 'true' if harakiri_verbose|default(True) else 'false' }}
max-requests = {{ max_requests|default(1000) }}
max-worker-lifetime = {{ max_worker_lifetime|default(3600) }}
reload-on-rss = {{ reload_on_rss|default(200) }}
worker-reload-mercy = {{ worker_reload_mercy|default(60) }}
reload-mercy = {{ reload_mercy|default(60) }}

; Socket configuration
socket-timeout = {{ socket_timeout|default(30) }}
so-keepalive = {{ 'true' if so_keepalive|default(True) else 'false' }}
listen = {{ listen|default(100) }}
buffer-size = {{ buffer_size|default(32768) }}
post-buffering = {{ post_buffering|default(8192) }}

; Process management
vacuum = {{ 'true' if vacuum|default(True) else 'false' }}
die-on-term = {{ 'true' if die_on_term|default(True) else 'false' }}
{% if pidfile|default(False) %}
pidfile = {{ pidfile }}
{% endif %}
{% if touch_reload|default(False) %}
touch-reload = {{ touch_reload }}
{% endif %}
{% if daemonize|default(False) %}
daemonize = {{ daemonize }}
{% endif %}

; Logging
{% if logto|default(False) %}
logto = {{ logto }}
{% endif %}
{% if log_date|default(False) %}
log-date = {{ log_date }}
{% endif %}
{% if log_format|default(False) %}
log-format = {{ log_format }}
{% endif %}
log-slow = {{ log_slow|default(1000) }}
log-4xx = {{ 'true' if log_4xx|default(True) else 'false' }}
log-5xx = {{ 'true' if log_5xx|default(True) else 'false' }}

; Static files
{% if static_map|default(False) %}
static-map = {{ static_map }}
{% endif %}
{% if static_expires|default(False) %}
static-expires = {{ static_expires }}
{% endif %}
{% if static_gzip_all|default(False) %}
static-gzip-all = {{ 'true' if static_gzip_all else 'false' }}
{% endif %}

; Auto-scaling
{% if cheaper|default(False) %}
cheaper = {{ cheaper }}
cheaper-algo = {{ cheaper_algo|default('busyness') }}
cheaper-initial = {{ cheaper_initial|default(2) }}
cheaper-step = {{ cheaper_step|default(1) }}
cheaper-overload = {{ cheaper_overload|default(5) }}
cheaper-idle = {{ cheaper_idle|default(20) }}
{% if cheaper_algo == 'busyness' %}
cheaper-busyness-multiplier = {{ cheaper_busyness_multiplier|default(30) }}
cheaper-busyness-min = {{ cheaper_busyness_min|default(20) }}
cheaper-busyness-max = {{ cheaper_busyness_max|default(70) }}
cheaper-busyness-backlog-alert = {{ cheaper_busyness_backlog_alert|default(16) }}
cheaper-busyness-backlog-step = {{ cheaper_busyness_backlog_step|default(2) }}
{% endif %}
{% endif %}

; Threading
{% if thunder_lock|default(False) %}
thunder-lock = true
{% endif %}
{% if lazy_apps|default(False) %}
lazy-apps = true
{% endif %}

; SSL
{% if ssl_enabled|default(False) %}
https = {{ socket|default('0.0.0.0:8443') }},{{ ssl_cert }},{{ ssl_key }}
{% endif %}

; Security
{% if limit_as|default(False) %}
limit-as = {{ limit_as }}
{% endif %}
{% if disable_write_exception|default(False) %}
disable-write-exception = true
{% endif %}

; Additional options
{% for key, value in additional_options|default({})|items() %}
{{ key }} = {{ value }}
{% endfor %}
